// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String
  price       Decimal  @db.Decimal(10, 2)
  stock       Int
  imageUrl    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  transactions     Transaction[]
  transactionItems TransactionItem[]

  @@map("products")
}

model Customer {
  id        String   @id @default(uuid())
  email     String   @unique
  phone     String
  fullName  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  transactions Transaction[]

  @@map("customers")
}

model Transaction {
  id                   String    @id @default(uuid())
  transactionNumber    String    @unique
  status               String // PENDING, APPROVED, DECLINED, ERROR
  customerId           String
  subtotal             Decimal   @db.Decimal(10, 2)
  baseFee              Decimal   @db.Decimal(10, 2)
  deliveryFee          Decimal   @db.Decimal(10, 2)
  total                Decimal   @db.Decimal(10, 2)
  serviceTransactionId String?
  serviceStatus        String?
  errorMessage         String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  processedAt          DateTime?

  customer  Customer          @relation(fields: [customerId], references: [id])
  delivery  Delivery?
  items     TransactionItem[]
  product   Product?          @relation(fields: [productId], references: [id])
  productId String?

  @@map("transactions")
}

model TransactionItem {
  id            String   @id @default(uuid())
  transactionId String
  productId     String
  productName   String
  quantity      Int
  price         Decimal  @db.Decimal(10, 2)
  subtotal      Decimal  @db.Decimal(10, 2)
  createdAt     DateTime @default(now())

  transaction Transaction @relation(fields: [transactionId], references: [id])
  product     Product     @relation(fields: [productId], references: [id])

  @@map("transaction_items")
}

model Delivery {
  id                    String   @id @default(uuid())
  transactionId         String   @unique
  address               String
  city                  String
  department            String
  trackingNumber        String   @unique
  estimatedDeliveryDate DateTime
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  transaction Transaction @relation(fields: [transactionId], references: [id])

  @@map("deliveries")
}
